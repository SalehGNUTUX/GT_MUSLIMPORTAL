<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة المسلم - GT-muslimportal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌙</text></svg>">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #2d5a27, #2b5876);
            color: #fff;
            min-height: 100vh;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        header {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 1000;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.85);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 15px;
        }

        .date-time-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-size: 0.9rem;
        }

        .hijri-date, .gregorian-date {
            margin-bottom: 5px;
        }

        .search-header {
            display: flex;
            width: 50%;
            max-width: 400px;
        }

        .search-header-input {
            flex: 1;
            padding: 8px 15px;
            border: none;
            border-radius: 50px 0 0 50px;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-right: none;
        }

        .search-header-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        .search-header-btn {
            padding: 8px 15px;
            background: #2d5a27;
            color: white;
            border: none;
            border-radius: 0 50px 50px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-header-btn:hover {
            background: #3a6b33;
        }

        footer {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            z-index: 1000;
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .developer {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #a3d39d;
        }

        .container {
            max-width: 1200px;
            margin: 180px auto 70px auto;
            padding: 20px;
            width: 100%;
            flex: 1;
            overflow-y: auto;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .description {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #e0e0e0;
        }

        .search-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .search-box {
            display: flex;
            width: 100%;
            max-width: 500px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 50px 0 0 50px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-right: none;
        }

        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        .search-btn {
            padding: 12px 20px;
            background: #2d5a27;
            color: white;
            border: none;
            border-radius: 0 50px 50px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: #3a6b33;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .service-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s ease;
            border-left: 4px solid;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .service-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .service-card.prayer-time {
            border-color: #4fc3f7;
        }

        .service-card.weather {
            border-color: #ffb74d;
        }

        .service-card.azkar {
            border-color: #81c784;
        }

        .service-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .service-card.prayer-time .service-icon {
            color: #4fc3f7;
        }

        .service-card.weather .service-icon {
            color: #ffb74d;
        }

        .service-card.azkar .service-icon {
            color: #81c784;
        }

        .service-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #fff;
        }

        .service-content {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 120px;
        }

        .prayer-times {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            text-align: right;
        }

        .prayer-time-item {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .current-prayer {
            background: rgba(79, 195, 247, 0.2);
            font-weight: bold;
        }

        .weather-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .weather-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .azkar-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .azkar-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            text-align: right;
        }

        .service-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            background: #2d5a27;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            background: #3a6b33;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn i {
            margin-left: 8px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-notification {
            background: #1565c0;
        }

        .btn-settings {
            background: #7b1fa2;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(40, 40, 40, 0.95);
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        .modal-title {
            font-size: 1.4rem;
            color: #a3d39d;
        }

        .close-modal {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .form-control:focus {
            outline: none;
            border-color: #2d5a27;
        }

        .notification-settings {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2d5a27;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .save-notification {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .location-settings {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .location-auto {
            padding: 8px 12px;
            background: #1565c0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .source-settings {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .custom-azkar {
            margin-top: 20px;
        }

        .custom-azkar-list {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .custom-azkar-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .remove-azkar {
            color: #ff5252;
            cursor: pointer;
        }

        .location-info {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #a3d39d;
        }

        @media (max-width: 768px) {
            header {
                padding: 60px 15px 15px 15px;
            }

            .header-top {
                flex-direction: column;
                gap: 15px;
            }

            .search-header {
                width: 100%;
                max-width: 100%;
            }

            .date-time-container {
                align-items: center;
            }

            h1 {
                font-size: 1.6rem;
                padding: 0 40px;
                margin-top: 10px;
            }

            .description {
                font-size: 0.9rem;
                padding: 0 20px;
            }

            .container {
                padding: 15px;
                margin: 200px auto 70px auto;
            }

            .services-grid {
                grid-template-columns: 1fr;
            }

            .service-card {
                padding: 20px;
            }

            .search-box {
                flex-direction: column;
            }

            .search-input {
                border-radius: 50px;
                margin-bottom: 10px;
                border-right: 1px solid rgba(255, 255, 255, 0.2);
            }

            .search-btn {
                border-radius: 50px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-top">
            <div class="date-time-container">
                <div class="hijri-date" id="hijri-date">🗓 التاريخ الهجري: جاري التحميل...</div>
                <div class="gregorian-date" id="gregorian-date">📅 التاريخ الميلادي: جاري التحميل...</div>
                <div class="current-time" id="current-time">⏰ 00:00:00</div>
            </div>
            <div class="search-header">
                <input type="text" class="search-header-input" placeholder="ابحث على الإنترنت...">
                <button class="search-header-btn" id="web-search-btn"><i class="fas fa-search"></i></button>
            </div>
        </div>
        <h1>بوابة المسلم - GT-muslimportal</h1>
        <p class="description">خدمات أوقات الصلاة، الطقس، والأذكار اليومية</p>
    </header>

    <div class="container">
        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="ابحث في الخدمات...">
                <button class="search-btn"><i class="fas fa-search"></i> بحث</button>
            </div>
        </div>

        <div class="services-grid">
            <!-- بطاقة أوقات الصلاة -->
            <div class="service-card prayer-time">
                <div class="service-icon">
                    <i class="fas fa-mosque"></i>
                </div>
                <h3 class="service-title">أوقات الصلاة</h3>
                <div class="service-content">
                    <div class="location-info" id="prayer-location">
                        📍 الموقع: جاري التحميل...
                    </div>
                    <div class="prayer-times" id="prayer-times">
                        <div class="loading">جاري تحميل أوقات الصلاة...</div>
                    </div>
                </div>
                <div class="service-actions">
                    <button class="btn btn-sm btn-notification" data-service="prayer">
                        <i class="fas fa-bell"></i> الإخطارات
                    </button>
                    <button class="btn btn-sm btn-settings" data-service="prayer">
                        <i class="fas fa-cog"></i> الإعدادات
                    </button>
                </div>
            </div>

            <!-- بطاقة الطقس -->
            <div class="service-card weather">
                <div class="service-icon">
                    <i class="fas fa-cloud-sun"></i>
                </div>
                <h3 class="service-title">حالة الطقس</h3>
                <div class="service-content">
                    <div class="location-info" id="weather-location">
                        📍 الموقع: جاري التحميل...
                    </div>
                    <div class="weather-info" id="weather-info">
                        <div class="loading">جاري تحميل بيانات الطقس...</div>
                    </div>
                </div>
                <div class="service-actions">
                    <button class="btn btn-sm btn-notification" data-service="weather">
                        <i class="fas fa-bell"></i> الإخطارات
                    </button>
                    <button class="btn btn-sm btn-settings" data-service="weather">
                        <i class="fas fa-cog"></i> الإعدادات
                    </button>
                </div>
            </div>

            <!-- بطاقة الأذكار -->
            <div class="service-card azkar">
                <div class="service-icon">
                    <i class="fas fa-praying-hands"></i>
                </div>
                <h3 class="service-title">أذكار اليوم</h3>
                <div class="service-content">
                    <div class="azkar-list" id="azkar-list">
                        <div class="loading">جاري تحميل الأذكار...</div>
                    </div>
                </div>
                <div class="service-actions">
                    <button class="btn btn-sm btn-notification" data-service="azkar">
                        <i class="fas fa-bell"></i> الإخطارات
                    </button>
                    <button class="btn btn-sm btn-settings" data-service="azkar">
                        <i class="fas fa-cog"></i> الإعدادات
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>جميع الحقوق محفوظة © 2025 | بوابة المسلم - GT-MUSLIMPORTAL</p>
        <p>صمم بحب <span style="color: #ff5252;">♥️</span> لخدمة القرآن الكريم والحديث النبوي</p>
        <p class="developer">تم التطوير بواسطة: GNUTUX</p>
    </footer>

    <!-- نافذة إعدادات الإخطارات -->
    <div class="modal" id="notification-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="notification-modal-title">إعدادات الإخطارات</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label>
                    تفعيل الإخطارات
                    <label class="switch">
                        <input type="checkbox" id="notifications-toggle">
                        <span class="slider"></span>
                    </label>
                </label>
            </div>
            <div class="notification-settings" id="notification-settings">
                <!-- سيتم ملء هذا القسم ديناميكيًا حسب الخدمة -->
            </div>
            <button class="btn" id="save-notifications-btn">حفظ الإعدادات</button>
        </div>
    </div>

    <!-- نافذة إعدادات الخدمات -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="settings-modal-title">إعدادات الخدمة</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="settings-content">
                <!-- سيتم ملء هذا القسم ديناميكيًا حسب الخدمة -->
            </div>
            <div class="source-settings">
                <h4>إعدادات المصادر</h4>
                <div class="form-group">
                    <label for="prayer-source">مصدر أوقات الصلاة:</label>
                    <select id="prayer-source" class="form-control">
                        <option value="aladhan">AlAdhan.com</option>
                        <option value="manual">يدوي</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="weather-source">مصدر الطقس:</label>
                    <select id="weather-source" class="form-control">
                        <option value="openweather">OpenWeatherMap</option>
                        <option value="manual">يدوي</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="azkar-source">مصدر الأذكار:</label>
                    <select id="azkar-source" class="form-control">
                        <option value="azkar-ml">Azkar.ml</option>
                        <option value="manual">يدوي</option>
                    </select>
                </div>
            </div>
            <button class="btn" id="save-settings-btn">حفظ الإعدادات</button>
        </div>
    </div>

    <div class="save-notification" id="save-notification">
        تم حفظ التغييرات بنجاح!
    </div>

    <script>
        // عناصر DOM
        const notificationButtons = document.querySelectorAll('.btn-notification');
        const settingsButtons = document.querySelectorAll('.btn-settings');
        const notificationModal = document.getElementById('notification-modal');
        const settingsModal = document.getElementById('settings-modal');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        const saveNotificationsBtn = document.getElementById('save-notifications-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const notificationsToggle = document.getElementById('notifications-toggle');
        const notificationSettings = document.getElementById('notification-settings');
        const saveNotification = document.getElementById('save-notification');
        const searchInput = document.querySelector('.search-input');
        const searchHeaderInput = document.querySelector('.search-header-input');
        const webSearchBtn = document.getElementById('web-search-btn');
        const serviceCards = document.querySelectorAll('.service-card');
        const hijriDateElement = document.getElementById('hijri-date');
        const gregorianDateElement = document.getElementById('gregorian-date');
        const currentTimeElement = document.getElementById('current-time');
        const prayerLocationElement = document.getElementById('prayer-location');
        const weatherLocationElement = document.getElementById('weather-location');

        // إعدادات التطبيق
        const DEFAULT_CITY = "Rabat";
        const DEFAULT_COUNTRY = "Morocco";
        const DEFAULT_METHOD = 26; // Morocco

        // تهيئة التطبيق
        function initApp() {
            // تحميل الإعدادات من localStorage
            loadSettings();

            // تحديث الوقت والتاريخ
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // جلب البيانات من المصادر
            fetchHijriDate();
            fetchPrayerTimes();
            fetchWeather();
            fetchAzkar();

            // إضافة event listeners
            notificationButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const service = e.currentTarget.dataset.service;
                    showNotificationModal(service);
                });
            });

            settingsButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const service = e.currentTarget.dataset.service;
                    showSettingsModal(service);
                });
            });

            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    notificationModal.style.display = 'none';
                    settingsModal.style.display = 'none';
                });
            });

            saveNotificationsBtn.addEventListener('click', saveNotificationSettings);
            saveSettingsBtn.addEventListener('click', saveServiceSettings);

            searchInput.addEventListener('input', filterServices);

            webSearchBtn.addEventListener('click', performWebSearch);
            searchHeaderInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performWebSearch();
                }
            });

            document.addEventListener('click', (e) => {
                if (e.target === notificationModal) {
                    notificationModal.style.display = 'none';
                }
                if (e.target === settingsModal) {
                    settingsModal.style.display = 'none';
                }
            });
        }

        // تحديث الوقت والتاريخ
        function updateDateTime() {
            const now = new Date();

            // الوقت الحالي
            const timeString = now.toLocaleTimeString('ar-SA', {
                hour12: true,
                hour: 'numeric',
                minute: 'numeric',
                second: 'numeric'
            });
            currentTimeElement.textContent = `⏰ ${timeString}`;

            // التاريخ الميلادي (باستخدام الأرقام العربية)
            const gregorianDate = now.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'numeric',
                day: 'numeric'
            }).replace(/[٠-٩]/g, d => "٠١٢٣٤٥٦٧٨٩".indexOf(d));
            gregorianDateElement.textContent = `📅 التاريخ الميلادي: ${gregorianDate}`;
        }

        // جلب التاريخ الهجري
        function fetchHijriDate() {
            const currentDate = new Date();
            const formattedDate = `${currentDate.getDate()}-${currentDate.getMonth() + 1}-${currentDate.getFullYear()}`;

            fetch(`http://api.aladhan.com/v1/gToH/${formattedDate}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const hijri = data.data.hijri;
                        hijriDateElement.innerHTML = `
                            🗓 التاريخ الهجري:<br>
                            📅 ${hijri.date} ${hijri.month.ar} ${hijri.year}هـ<br>
                            🌙 ${hijri.weekday.ar}<br>
                            ✅ موافق ل<br>
                            📅 التاريخ الميلادي: ${formattedDate.split('-').join('-')}
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error fetching hijri date:', error);
                    hijriDateElement.textContent = '❌ فشل في تحميل التاريخ الهجري';
                });
        }

        // جلب أوقات الصلاة من API
        function fetchPrayerTimes() {
            const currentDate = new Date();
            const formattedDate = `${currentDate.getDate()}-${currentDate.getMonth() + 1}-${currentDate.getFullYear()}`;

            fetch(`https://api.aladhan.com/v1/timingsByCity/${formattedDate}?city=${DEFAULT_CITY}&country=${DEFAULT_COUNTRY}&method=${DEFAULT_METHOD}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const timings = data.data.timings;
                        const meta = data.data.meta;
                        updatePrayerTimes(timings, meta);
                    }
                })
                .catch(error => {
                    console.error('Error fetching prayer times:', error);
                    document.getElementById('prayer-times').innerHTML = '<div class="loading">❌ فشل في تحميل أوقات الصلاة</div>';
                });
        }

        // تحديث عرض أوقات الصلاة
        function updatePrayerTimes(timings, meta) {
            const prayerTimesElement = document.getElementById('prayer-times');

            // تحديث معلومات الموقع
            prayerLocationElement.innerHTML = `📍 الموقع: ${meta.timezone}, ${meta.method.name}`;

            prayerTimesElement.innerHTML = '';

            const prayers = [
                { name: '🌅 الفجر', time: timings.Fajr, key: 'Fajr' },
                { name: '🌞 الشروق', time: timings.Sunrise, key: 'Sunrise' },
                { name: '☀️ الظهر', time: timings.Dhuhr, key: 'Dhuhr' },
                { name: '🌇 العصر', time: timings.Asr, key: 'Asr' },
                { name: '🌆 المغرب', time: timings.Maghrib, key: 'Maghrib' },
                { name: '🌙 العشاء', time: timings.Isha, key: 'Isha' }
            ];

            prayers.forEach(prayer => {
                const timeItem = document.createElement('div');
                timeItem.className = 'prayer-time-item';
                timeItem.id = `prayer-${prayer.key}`;
                timeItem.textContent = `${prayer.name}: ${formatPrayerTime(prayer.time)}`;
                prayerTimesElement.appendChild(timeItem);
            });

            // تحديد الصلاة الحالية
            highlightCurrentPrayer(timings);
        }

        // تنسيق وقت الصلاة
        function formatPrayerTime(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const period = hour >= 12 ? 'م' : 'ص';
            const formattedHour = hour % 12 || 12;
            return `${formattedHour}:${minutes} ${period}`;
        }

        // تحديد الصلاة الحالية
        function highlightCurrentPrayer(timings) {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();

            const prayerTimes = [
                { key: 'Fajr', time: convertTimeToMinutes(timings.Fajr) },
                { key: 'Dhuhr', time: convertTimeToMinutes(timings.Dhuhr) },
                { key: 'Asr', time: convertTimeToMinutes(timings.Asr) },
                { key: 'Maghrib', time: convertTimeToMinutes(timings.Maghrib) },
                { key: 'Isha', time: convertTimeToMinutes(timings.Isha) }
            ];

            let currentPrayer = null;
            let nextPrayer = null;

            for (let i = 0; i < prayerTimes.length; i++) {
                if (currentTime < prayerTimes[i].time) {
                    nextPrayer = prayerTimes[i].key;
                    if (i > 0) {
                        currentPrayer = prayerTimes[i - 1].key;
                    }
                    break;
                }
            }

            // إذا لم نجد صلاة قادمة، فإن الصلاة الحالية هي العشاء والصلاة القادمة هي الفجر في اليوم التالي
            if (!nextPrayer) {
                currentPrayer = 'Isha';
                nextPrayer = 'Fajr';
            }

            // إزالة التمييز من جميع الصلوات
            document.querySelectorAll('.prayer-time-item').forEach(item => {
                item.classList.remove('current-prayer');
            });

            // تمييز الصلاة الحالية إذا وجدت
            if (currentPrayer) {
                const currentPrayerElement = document.getElementById(`prayer-${currentPrayer}`);
                if (currentPrayerElement) {
                    currentPrayerElement.classList.add('current-prayer');
                }
            }
        }

        // تحويل الوقت إلى دقائق
        function convertTimeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // جلب بيانات الطقس من API
        function fetchWeather() {
            // إعدادات الموقع الافتراضية (مكة المكرمة)
            const latitude = 21.4225;
            const longitude = 39.8262;
            const apiKey = 'your_openweather_api_key'; // يجب استبدالها بمفتاح API الحقيقي

            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric&lang=ar`)
                .then(response => response.json())
                .then(data => {
                    updateWeather(data);
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    document.getElementById('weather-info').innerHTML = '<div class="loading">❌ فشل في تحميل بيانات الطقس</div>';
                });
        }

        // تحديث عرض بيانات الطقس
        function updateWeather(weatherData) {
            const weatherInfoElement = document.getElementById('weather-info');

            // تحديث معلومات الموقع
            weatherLocationElement.innerHTML = `📍 الموقع: ${weatherData.name}, ${weatherData.sys.country}`;

            if (weatherData && weatherData.main) {
                weatherInfoElement.innerHTML = `
                    <div class="weather-item">
                        <span>الحالة:</span>
                        <span>${weatherData.weather[0].description}</span>
                    </div>
                    <div class="weather-item">
                        <span>درجة الحرارة:</span>
                        <span>${Math.round(weatherData.main.temp)}°م</span>
                    </div>
                    <div class="weather-item">
                        <span>الرطوبة:</span>
                        <span>${weatherData.main.humidity}%</span>
                    </div>
                    <div class="weather-item">
                        <span>الرياح:</span>
                        <span>${Math.round(weatherData.wind.speed * 3.6)} كم/س</span>
                    </div>
                `;
            }
        }

        // جلب الأذكار من API
        function fetchAzkar() {
            // جلب أذكار الصباح
            fetch('https://azkar.ml/zekr?m=true&json=true')
                .then(response => response.json())
                .then(data => {
                    if (data && data.content) {
                        updateAzkar(data.content);
                    }
                })
                .catch(error => {
                    console.error('Error fetching azkar:', error);
                    document.getElementById('azkar-list').innerHTML = '<div class="loading">❌ فشل في تحميل الأذكار</div>';
                });
        }

        // تحديث عرض الأذكار
        function updateAzkar(azkarContent) {
            const azkarListElement = document.getElementById('azkar-list');
            azkarListElement.innerHTML = '';

            const azkarItem = document.createElement('div');
            azkarItem.className = 'azkar-item';
            azkarItem.innerHTML = `<p>${azkarContent}</p>`;
            azkarListElement.appendChild(azkarItem);

            // إضافة أذكار إضافية (يمكن جلبها من مصادر أخرى)
            const additionalAzkar = [
                "أستغفر الله العظيم الذي لا إله إلا هو الحي القيوم وأتوب إليه",
                "سبحان الله وبحمده، سبحان الله العظيم",
                "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير"
            ];

            additionalAzkar.forEach(zekr => {
                const azkarItem = document.createElement('div');
                azkarItem.className = 'azkar-item';
                azkarItem.innerHTML = `<p>${zekr}</p>`;
                azkarListElement.appendChild(azkarItem);
            });
        }

        // عرض نافذة إعدادات الإخطارات
        function showNotificationModal(service) {
            const modalTitle = document.getElementById('notification-modal-title');
            let title = '';
            let settingsHTML = '';

            switch(service) {
                case 'prayer':
                    title = 'إخطارات أوقات الصلاة';
                    settingsHTML = `
                        <div class="form-group">
                            <label>الإخطار عند وقت الصلاة</label>
                            <label class="switch">
                                <input type="checkbox" id="prayer-time-notification" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>الإخطار قبل الصلاة بـ 10 دقائق</label>
                            <label class="switch">
                                <input type="checkbox" id="prayer-before-notification">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>تحديد الوقت يدوياً</label>
                            <input type="number" class="form-control" id="prayer-custom-time" placeholder="عدد الدقائق قبل الصلاة" min="1" max="60">
                        </div>
                        <div class="form-group">
                            <label>طريقة عرض الوقت</label>
                            <select class="form-control" id="time-format">
                                <option value="12">12 ساعة (ص/م)</option>
                                <option value="24">24 ساعة</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'weather':
                    title = 'إخطارات الطقس';
                    settingsHTML = `
                        <div class="form-group">
                            <label>تفعيل إخطارات الطقس</label>
                            <label class="switch">
                                <input type="checkbox" id="weather-notification" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>فاصل التحديث (بالدقائق)</label>
                            <input type="number" class="form-control" id="weather-interval" value="60" min="15" max="1440">
                        </div>
                    `;
                    break;
                case 'azkar':
                    title = 'إخطارات الأذكار';
                    settingsHTML = `
                        <div class="form-group">
                            <label>تفعيل إخطارات الأذكار</label>
                            <label class="switch">
                                <input type="checkbox" id="azkar-notification" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>فاصل التذكير (بالدقائق)</label>
                            <input type="number" class="form-control" id="azkar-interval" value="30" min="5" max="240">
                        </div>
                        <div class="form-group">
                            <label>عرض أذكار عشوائية</label>
                            <label class="switch">
                                <input type="checkbox" id="azkar-random" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `;
                    break;
            }

            modalTitle.textContent = title;
            notificationSettings.innerHTML = settingsHTML;
            notificationModal.style.display = 'flex';
        }

        // عرض نافذة إعدادات الخدمات
        function showSettingsModal(service) {
            const modalTitle = document.getElementById('settings-modal-title');
            let title = '';
            let settingsHTML = '';

            switch(service) {
                case 'prayer':
                    title = 'إعدادات أوقات الصلاة';
                    settingsHTML = `
                        <div class="form-group">
                            <label>الموقع الجغرافي</label>
                            <div class="location-settings">
                                <input type="text" class="form-control" id="prayer-location" placeholder="اسم المدينة">
                                <button class="location-auto" id="prayer-location-auto"><i class="fas fa-location-arrow"></i> التحديد التلقائي</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>طريقة الحساب</label>
                            <select class="form-control" id="prayer-method">
                                <option value="1">جامعة العلوم الإسلامية (كراتشي)</option>
                                <option value="2">الهيئة العامة للمساحة المصرية</option>
                                <option value="3">رابطة العالم الإسلامي</option>
                                <option value="4" selected>أم القرى (مكة المكرمة)</option>
                                <option value="5">الإمارات العربية المتحدة</option>
                                <option value="6">الجزائر، المغرب، تونس</option>
                                <option value="26">المغرب</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'weather':
                    title = 'إعدادات الطقس';
                    settingsHTML = `
                        <div class="form-group">
                            <label>الموقع الجغرافي</label>
                            <div class="location-settings">
                                <input type="text" class="form-control" id="weather-location" placeholder="اسم المدينة">
                                <button class="location-auto" id="weather-location-auto"><i class="fas fa-location-arrow"></i> التحديد التلقائي</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>وحدات القياس</label>
                            <select class="form-control" id="weather-units">
                                <option value="metric">مئوية (°م)</option>
                                <option value="imperial">فهرنهايت (°ف)</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'azkar':
                    title = 'إعدادات الأذكار';
                    settingsHTML = `
                        <div class="form-group">
                            <label>إضافة ذكر جديد</label>
                            <textarea class="form-control" id="new-azkar" placeholder="اكتب الذكر هنا..."></textarea>
                            <button class="btn btn-sm" id="add-azkar-btn" style="margin-top: 10px;"><i class="fas fa-plus"></i> إضافة</button>
                        </div>
                        <div class="custom-azkar">
                            <h4>الأذكار المضافة يدوياً</div>
                            <div class="custom-azkar-list" id="custom-azkar-list">
                                <!-- سيتم ملؤها ديناميكياً -->
                            </div>
                        </div>
                    `;
                    break;
            }

            modalTitle.textContent = title;
            document.getElementById('settings-content').innerHTML = settingsHTML;
            settingsModal.style.display = 'flex';

            // إضافة event listeners خاصة بكل خدمة
            if (service === 'azkar') {
                document.getElementById('add-azkar-btn').addEventListener('click', addCustomAzkar);
                loadCustomAzkar();
            }

            if (service === 'prayer') {
                document.getElementById('prayer-location-auto').addEventListener('click', getLocationForPrayer);
            }

            if (service === 'weather') {
                document.getElementById('weather-location-auto').addEventListener('click', getLocationForWeather);
            }
        }

        // الحصول على الموقع الجغرافي لأوقات الصلاة
        function getLocationForPrayer() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        // استخدام خدمة عكسية للجيو-كودينج للحصول على اسم المدينة
                        fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=ar`)
                            .then(response => response.json())
                            .then(data => {
                                const city = data.city || data.locality || 'موقعك الحالي';
                                document.getElementById('prayer-location').value = city;
                            })
                            .catch(error => {
                                console.error('Error getting location name:', error);
                                document.getElementById('prayer-location').value = 'موقعك الحالي';
                            });
                    },
                    error => {
                        alert('تعذر الحصول على الموقع. يرجى التأكد من تفعيل خدمات الموقع.');
                    }
                );
            } else {
                alert('متصفحك لا يدعم خدمات الموقع.');
            }
        }

        // الحصول على الموقع الجغرافي للطقس
        function getLocationForWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        // استخدام خدمة عكسية للجيو-كودينج للحصول على اسم المدينة
                        fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=ar`)
                            .then(response => response.json())
                            .then(data => {
                                const city = data.city || data.locality || 'موقعك الحالي';
                                document.getElementById('weather-location').value = city;
                            })
                            .catch(error => {
                                console.error('Error getting location name:', error);
                                document.getElementById('weather-location').value = 'موقعك الحالي';
                            });
                    },
                    error => {
                        alert('تعذر الحصول على الموقع. يرجى التأكد من تفعيل خدمات الموقع.');
                    }
                );
            } else {
                alert('متصفحك لا يدعم خدمات الموقع.');
            }
        }

        // إضافة ذكر مخصص
        function addCustomAzkar() {
            const newAzkarInput = document.getElementById('new-azkar');
            const azkarText = newAzkarInput.value.trim();

            if (azkarText) {
                let customAzkar = JSON.parse(localStorage.getItem('customAzkar') || '[]');
                customAzkar.push(azkarText);
                localStorage.setItem('customAzkar', JSON.stringify(customAzkar));

                newAzkarInput.value = '';
                loadCustomAzkar();
            }
        }

        // تحميل الأذكار المخصصة
        function loadCustomAzkar() {
            const customAzkarList = document.getElementById('custom-azkar-list');
            const customAzkar = JSON.parse(localStorage.getItem('customAzkar') || '[]');

            customAzkarList.innerHTML = '';

            if (customAzkar.length === 0) {
                customAzkarList.innerHTML = '<p style="text-align: center; padding: 10px;">لا توجد أذكار مضافة</p>';
                return;
            }

            customAzkar.forEach((azkar, index) => {
                const azkarItem = document.createElement('div');
                azkarItem.className = 'custom-azkar-item';
                azkarItem.innerHTML = `
                    <span>${azkar}</span>
                    <span class="remove-azkar" data-index="${index}"><i class="fas fa-trash"></i></span>
                `;
                customAzkarList.appendChild(azkarItem);
            });

            // إضافة event listeners لأزرار الحذف
            document.querySelectorAll('.remove-azkar').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    removeCustomAzkar(index);
                });
            });
        }

        // إزالة ذكر مخصص
        function removeCustomAzkar(index) {
            let customAzkar = JSON.parse(localStorage.getItem('customAzkar') || '[]');
            customAzkar.splice(index, 1);
            localStorage.setItem('customAzkar', JSON.stringify(customAzkar));
            loadCustomAzkar();
        }

        // حفظ إعدادات الإخطارات
        function saveNotificationSettings() {
            // هنا سيتم حفظ إعدادات الإخطارات في localStorage
            showSaveNotification();
            notificationModal.style.display = 'none';
        }

        // حفظ إعدادات الخدمات
        function saveServiceSettings() {
            // هنا سيتم حفظ إعدادات الخدمات في localStorage
            showSaveNotification();
            settingsModal.style.display = 'none';
        }

        // عرض إشعار الحفظ
        function showSaveNotification() {
            saveNotification.style.display = 'block';
            setTimeout(() => {
                saveNotification.style.display = 'none';
            }, 3000);
        }

        // تحميل الإعدادات من localStorage
        function loadSettings() {
            // هنا سيتم تحميل الإعدادات من localStorage
            // هذا مثال بسيط للتوضيح
            const savedPrayerSettings = localStorage.getItem('prayerSettings');
            if (savedPrayerSettings) {
                // تطبيق إعدادات الصلاة
            }

            const savedWeatherSettings = localStorage.getItem('weatherSettings');
            if (savedWeatherSettings) {
                // تطبيق إعدادات الطقس
            }

            const savedAzkarSettings = localStorage.getItem('azkarSettings');
            if (savedAzkarSettings) {
                // تطبيق إعدادات الأذكار
            }
        }

        // تصفية الخدمات عند البحث
        function filterServices() {
            const searchTerm = searchInput.value.toLowerCase();

            serviceCards.forEach(card => {
                const title = card.querySelector('.service-title').textContent.toLowerCase();
                const content = card.querySelector('.service-content').textContent.toLowerCase();

                if (title.includes(searchTerm) || content.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // البحث على الإنترنت باستخدام Brave Search
        function performWebSearch() {
            const searchTerm = searchHeaderInput.value.trim();
            if (searchTerm) {
                window.open(`https://search.brave.com/search?q=${encodeURIComponent(searchTerm)}`, '_blank');
            }
        }

        // تهيئة التطبيق عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
